generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                    Int                       @id @default(autoincrement())
  email                 String                    @unique @db.VarChar(100)
  password              String                    @db.VarChar(255)
  status                UserStatus                @default(NOT_VERIFIED)
  createdAt             DateTime                  @map("created_at") @default(now())
  updatedAt             DateTime                  @map("updated_at") @updatedAt
  profile               Profile?
  tokens                Token[]           
}

model Token {
  id                    Int                       @id @default(autoincrement())
  userId                Int                       @map("user_id")
  user                  User                      @relation(fields: [userId], references: [id])
  token                 String                    @unique
  type                  TokenType
}

enum TokenType {
  REFRESH
  VERIFICATION
  RESET_PASSWORD
}

model Profile {   
  userId                Int                       @id @map("user_id")
  firstname             String                    @db.VarChar(30)
  lastname              String                    @db.VarChar(30)
  birthdate             String?                   @db.VarChar(10)
  gender                Gender?                   @default(OTHER) 
  pathPicture           String?                   @map("path_picture") @db.VarChar(255)
  description           String?                   @db.VarChar(2000)
  budget                Budget?       
  availableFrom         DateTime?                 @map("available_from")
  availableTo           DateTime?                 @map("available_to")
  createdAt             DateTime                  @map("created_at") @default(now())
  updatedAt             DateTime                  @map("updated_at") @updatedAt
  user                  User                      @relation(fields: [userId], references: [id])
  travelTypes           ProfileTravelTypes[] 
  lodgings              ProfileLodgings[]         
  interests             ProfileInterests[]        
  languages             ProfileLanguages[]        
  tripDurations         ProfileTripDurations[]    
  notifications         Notification[]        
  medias                Media[]       
  groups                GroupUser[]       
  ratingsGiven          Rating[]                  @relation("RaterUser")
  ratingsReceived       Rating[]                  @relation("RatedUser")
  moderatingsGiven      Moderating[]              @relation("ModeraterUser")
  moderatingsReceived   Moderating[]              @relation("ModeratedUser")
  messagesSent          Message[]                 @relation("SenderUser")
  messagesReceived      Message[]                 @relation("ReceiverUser")
}   

model Stage {   
  id                    Int                       @id @default(autoincrement())
  title                 String                    @db.VarChar(100)
  description           String                    @db.VarChar(2000)
  dateFrom              DateTime                  @map("date_from")
  dateTo                DateTime                  @map("date_to")
  pathPicture           String                    @map("path_picture") @db.VarChar(255)
  address               String                    @db.VarChar(255)
  longitude             Float       
  latitude              Float       
  groupId               Int                       @map("group_id")
  createdAt             DateTime                  @map("created_at") @default(now())
  updatedAt             DateTime                  @map("updated_at") @updatedAt
  group                 Group                     @relation(fields: [groupId], references: [id])
  checklist             Checklist[]   
}   

model Group {   
  id                    Int                       @id @default(autoincrement())
  title                 String                    @db.VarChar(100)
  description           String                    @db.VarChar(2000)
  location              String                    @db.VarChar(255)
  dateFrom              DateTime                  @map("date_from")
  dateTo                DateTime                  @map("date_to") 
  pathPicture           String                    @map("path_picture") @db.VarChar(255)
  status                GroupStatus               @default(PENDING)
  genderType            GenderType?               @default(MIXED) @map("gender_type")
  budget                Budget?       
  stages                Stage[]       
  travelTypes           GroupTravelTypes[]              
  lodgings              GroupLodgings[]                 
  languages             GroupLanguages[]                
  ageRanges             GroupAgeRanges[]                
  members               GroupUser[]       
  medias                Media[]       
  messagesReceived      Message[]       
  checklist             Checklist[]       
}       

model GroupUser {       
  userId                Int                       @map("user_id")
  groupId               Int                       @map("group_id")
  role                  GroupRole       
  status                GroupStatus       
  createdAt             DateTime                  @map("created_at") @default(now())
  updatedAt             DateTime                  @map("updated_at")  @updatedAt
  user                  Profile                   @relation(fields: [userId], references: [userId])
  group                 Group                     @relation(fields: [groupId], references: [id])
  @@id([userId, groupId])       
}       

model Notification {        
  id                    Int                       @id @default(autoincrement())
  userId                Int                       @map("user_id")
  referenceId           Int                       @map("reference_id")
  referenceType         ReferenceType             @map("reference_type")
  isRead                Boolean                   @default(false) @map("is_read")
  createdAt             DateTime                  @map("created_at") @default(now())
  updatedAt             DateTime                  @map("updated_at") @updatedAt
  user                  Profile                   @relation(fields: [userId], references: [userId])
}       

model Media {       
  id                    Int                       @id @default(autoincrement())
  userId                Int                       @map("user_id")
  groupId               Int                       @map("group_id")
  alt                   String                    @db.VarChar(255)
  path                  String                    @unique @db.VarChar(255)
  createdAt             DateTime                  @map("created_at") @default(now())
  user                  Profile                   @relation(fields: [userId], references: [userId])
  group                 Group                     @relation(fields: [groupId], references: [id])
}       

model Rating {        
  raterId               Int                       @map("rater_id")
  ratedId               Int                       @map("rated_id")
  value                 Int       
  createdAt             DateTime                  @map("created_at") @default(now())
  rater                 Profile                   @relation("RaterUser", fields: [raterId], references: [userId])
  rated                 Profile                   @relation("RatedUser", fields: [ratedId], references: [userId])
  @@id([raterId, ratedId])        
}       

model Moderating {        
  moderaterId           Int                       @map("moderater_id")
  moderatedId           Int                       @map("moderated_id")
  value                 Int       
  createdAt             DateTime                  @map("created_at") @default(now())
  moderater             Profile                   @relation("ModeraterUser", fields: [moderaterId], references: [userId])
  moderated             Profile                   @relation("ModeratedUser", fields: [moderatedId], references: [userId])
  @@id([moderaterId, moderatedId])        
}       

model Message {       
  id                    Int                       @id @default(autoincrement())
  content               String                    @db.VarChar(1000)
  senderId              Int                       @map("sender_id")
  userReceiverId        Int?                      @map("user_receiver_id")
  groupReceiverId       Int?                      @map("group_receiver_id")
  createdAt             DateTime                  @map("created_at") @default(now())
  senderUser            Profile                   @relation("SenderUser", fields: [senderId], references: [userId])
  receiverUser          Profile?                  @relation("ReceiverUser", fields: [userReceiverId], references: [userId])
  receiverGroup         Group?                    @relation(fields: [groupReceiverId], references: [id])
}       

model Checklist {       
  id                    Int                       @id @default(autoincrement())
  stageId               Int?                      @map("stage_id")
  groupId               Int?                      @map("group_id")
  item                  String                    @db.VarChar(50)
  createdAt             DateTime                  @map("created_at") @default(now())
  updatedAt             DateTime                  @map("updated_at") @updatedAt
  stage                 Stage?                    @relation(fields: [stageId], references: [id])
  group                 Group?                    @relation(fields: [groupId], references: [id])
}       

model TravelType {        
  id                    Int                       @id @default(autoincrement())
  name                  String                    @unique @db.VarChar(100)
  profiles              ProfileTravelTypes[]             
  groups                GroupTravelTypes[]               
}   

model Lodging {   
  id                    Int                       @id @default(autoincrement())
  name                  String                    @unique @db.VarChar(100)
  profiles              ProfileLodgings[]                 
  groups                GroupLodgings[]                   
}       

model Interest {        
  id                    Int                       @id @default(autoincrement())
  name                  String                    @unique @db.VarChar(100)
  profiles              ProfileInterests[]         
}       

model Language {        
  id                    Int                       @id @default(autoincrement())
  name                  String                    @unique @db.VarChar(100)
  profiles              ProfileLanguages[]                 
  groups                GroupLanguages[]                   
}       

model TripDuration {        
  id                    Int                       @id @default(autoincrement())
  name                  String                    @unique @db.VarChar(100)
  profiles              ProfileTripDurations[]         
}   

model AgeRange {    
  id                    Int                       @id @default(autoincrement())
  name                  String                    @unique @db.VarChar(100)
  groups                GroupAgeRanges[]        
}   

model ProfileTravelTypes {    
  userId                Int                       @map("user_id")
  travelTypeId          Int                       @map("travel_type_id")
  profile               Profile                   @relation(fields: [userId], references: [userId])
  travelType            TravelType                @relation(fields: [travelTypeId], references: [id])
  @@id([userId, travelTypeId])    
}   

model ProfileLodgings {   
  userId                Int                       @map("user_id")                          
  lodgingId             Int                       @map("lodging_id")
  profile               Profile                   @relation(fields: [userId], references: [userId])
  lodging               Lodging                   @relation(fields: [lodgingId], references: [id])
  @@id([userId, lodgingId])   
}   

model ProfileInterests {    
  userId                Int                       @map("user_id")
  interestId            Int                       @map("interest_id")
  profile               Profile                   @relation(fields: [userId], references: [userId])
  interest              Interest                  @relation(fields: [interestId], references: [id])
  @@id([userId, interestId])    
}   

model ProfileLanguages {    
  userId                Int                       @map("user_id")
  languageId            Int                       @map("language_id")
  profile               Profile                   @relation(fields: [userId], references: [userId])
  language              Language                  @relation(fields: [languageId], references: [id])
  @@id([userId, languageId])          
}         

model ProfileTripDurations {            
  userId                Int                       @map("user_id")
  tripDurationId        Int                       @map("trip_duration_id")
  profile               Profile                   @relation(fields: [userId], references: [userId])
  tripDuration          TripDuration              @relation(fields: [tripDurationId], references: [id])
  @@id([userId, tripDurationId])          
}         

model GroupTravelTypes {          
  groupId               Int                       @map("group_id")
  travelTypeId          Int                       @map("travel_type_id")
  group                 Group                     @relation(fields: [groupId], references: [id])
  travelType            TravelType                @relation(fields: [travelTypeId], references: [id])
  @@id([groupId, travelTypeId])         
}         

model GroupLodgings {         
  groupId               Int                       @map("group_id")
  lodgingId             Int                       @map("lodging_id")
  group                 Group                     @relation(fields: [groupId], references: [id])
  lodging               Lodging                   @relation(fields: [lodgingId], references: [id])
  @@id([groupId, lodgingId])          
}         

model GroupLanguages {          
  groupId               Int                       @map("group_id")
  languageId            Int                       @map("language_id")
  group                 Group                     @relation(fields: [groupId], references: [id])
  language              Language                  @relation(fields: [languageId], references: [id])
  @@id([groupId, languageId])         
}         

model GroupAgeRanges {          
  groupId               Int                       @map("group_id")
  ageRangeId            Int                       @map("age_range_id")
  group                 Group                     @relation(fields: [groupId], references: [id])
  ageRange              AgeRange                  @relation(fields: [ageRangeId], references: [id])
  @@id([groupId, ageRangeId])
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum Budget {
  LOW
  MIDDLE
  HIGH
  LUXURY
}

enum UserStatus {
  NOT_VERIFIED
  VERIFIED
  BANNED
}

enum GroupStatus {
  PENDING
  IN_PROGRESS
  FINISHED
}

enum GroupRole {
  TRAVELER
  ORGANIZER
  AUTHOR
}

enum GenderType {
  MALE
  FEMALE
  OTHER
  MIXED
}

enum ReferenceType {
  PRIVATE_MESSAGE
  GROUP_MESSAGE
  GROUP_MODIFICATION
}